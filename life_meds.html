<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINET LIFE - Dnevna Terapija v5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { life: { bg: '#f0f9ff', accent: '#0ea5e9', purple: '#7c3aed', meds: '#6366f1' } } } }
        }
    </script>
    <style>
        .med-card { transition: all 0.3s ease; }
        .med-taken { opacity: 0.6; background-color: #f8fafc !important; border-color: #e2e8f0 !important; }
        .check-anim { transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="bg-life-bg min-h-screen font-sans" onload="initMeds()">

    <header class="bg-white shadow-md p-6 sticky top-0 z-50 no-print">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-pills text-life-meds text-2xl"></i>
                <h1 class="text-xl font-black text-slate-800 uppercase italic tracking-tighter">DNEVNA <span class="text-life-meds">TERAPIJA</span></h1>
            </div>
            <button onclick="window.location.href='life_hub.html'" class="bg-slate-900 text-white px-5 py-2 rounded-full font-black text-[10px] uppercase shadow-lg">
                <i class="fa-solid fa-circle-arrow-left mr-1"></i> HUB
            </button>
        </div>
    </header>

    <main class="p-4 max-w-xl mx-auto space-y-6 pb-24">
        <section class="flex justify-between items-center px-2 no-print">
            <h2 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">AKTIVNI LEKOVI</h2>
            <button onclick="openAddMedModal()" class="bg-life-meds text-white px-4 py-2 rounded-xl font-black text-[10px] uppercase shadow-md">
                <i class="fa-solid fa-plus-circle mr-1"></i> DODAJ LEK
            </button>
        </section>

        <div id="meds-list" class="space-y-3">
            </div>

        <button onclick="window.print()" class="w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl text-[10px] uppercase tracking-widest no-print hover:bg-slate-200 transition">
            <i class="fa-solid fa-print mr-2"></i> Štampaj listu terapije
        </button>
    </main>

    <div id="medModal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 border-8 border-white shadow-2xl">
            <h3 class="font-black uppercase text-slate-800 mb-6 text-sm border-b pb-2 italic">DODAVANJE TERAPIJE</h3>
            <div class="space-y-4">
                <div><label class="text-[9px] font-black text-slate-400 block mb-1 uppercase">Naziv Leka</label><input type="text" id="m-name" placeholder="Npr. Paravano" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border-none"></div>
                <div><label class="text-[9px] font-black text-slate-400 block mb-1 uppercase">Doza / Količina</label><input type="text" id="m-dose" placeholder="Npr. 20mg (1 tableta)" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border-none"></div>
                <div><label class="text-[9px] font-black text-slate-400 block mb-1 uppercase">Vreme Uzimanja</label><input type="time" id="m-time" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border-none"></div>
            </div>
            <div class="mt-8 flex gap-3">
                <button onclick="saveMed()" class="flex-1 bg-life-meds text-white font-black py-4 rounded-2xl shadow-lg uppercase text-xs">SAČUVAJ</button>
                <button onclick="closeModal()" class="bg-slate-100 text-slate-400 px-6 py-4 rounded-2xl font-black uppercase text-[10px]">X</button>
            </div>
        </div>
    </div>

    <script>
        let medsData = JSON.parse(localStorage.getItem('sinet_life_meds')) || [];
        const today = new Date().toLocaleDateString('sr-RS');
        let medsStatus = JSON.parse(localStorage.getItem('sinet_meds_status')) || { date: today, takenIds: [] };

        // RESET STATUS AKO JE NOVI DAN (SINET PROTOKOL)
        if (medsStatus.date !== today) {
            medsStatus = { date: today, takenIds: [] };
            localStorage.setItem('sinet_meds_status', JSON.stringify(medsStatus));
        }

        function initMeds() { renderMeds(); }

        function openAddMedModal() { document.getElementById('medModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('medModal').classList.add('hidden'); }

        function saveMed() {
            const med = {
                id: Date.now(),
                name: document.getElementById('m-name').value,
                dose: document.getElementById('m-dose').value,
                time: document.getElementById('m-time').value
            };
            if(!med.name || !med.dose) return alert("Popunite polja!");
            medsData.push(med);
            localStorage.setItem('sinet_life_meds', JSON.stringify(medsData));
            closeModal();
            renderMeds();
        }

        function toggleTaken(id) {
            const idx = medsStatus.takenIds.indexOf(id);
            if (idx > -1) medsStatus.takenIds.splice(idx, 1);
            else medsStatus.takenIds.push(id);
            localStorage.setItem('sinet_meds_status', JSON.stringify(medsStatus));
            renderMeds();
        }

        function renderMeds() {
            const container = document.getElementById('meds-list');
            if(medsData.length === 0) {
                container.innerHTML = `<p class="text-center opacity-30 italic py-10">Lista terapije je prazna.</p>`;
                return;
            }
            // Sortiranje po vremenu uzimanja
            medsData.sort((a,b) => a.time.localeCompare(b.time));

            container.innerHTML = medsData.map(m => {
                const isTaken = medsStatus.takenIds.includes(m.id);
                return `
                <div class="med-card bg-white p-5 rounded-[2rem] border border-slate-100 flex justify-between items-center shadow-sm ${isTaken ? 'med-taken' : ''}" onclick="toggleTaken(${m.id})">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 ${isTaken ? 'bg-green-500 text-white' : 'bg-indigo-100 text-indigo-600'} rounded-full flex items-center justify-center text-xl check-anim">
                            <i class="fa-solid ${isTaken ? 'fa-check' : 'fa-capsules'}"></i>
                        </div>
                        <div>
                            <span class="text-[8px] font-mono text-slate-400 block uppercase tracking-widest">${m.time} h</span>
                            <h4 class="font-black text-slate-800 text-lg tracking-tighter leading-none">${m.name}</h4>
                            <p class="text-[9px] font-bold text-slate-400 uppercase mt-1">${m.dose}</p>
                        </div>
                    </div>
                    <div class="flex gap-2 no-print" onclick="event.stopPropagation()">
                         <button onclick="sendMedToIndex(${m.id})" class="text-purple-300 hover:text-purple-600 p-2"><i class="fa-solid fa-address-book text-xl"></i></button>
                         <button onclick="deleteMed(${m.id})" class="text-slate-100 hover:text-red-500 p-2"><i class="fa-solid fa-trash-can text-xl"></i></button>
                    </div>
                </div>`;
            }).join('');
        }

        function sendMedToIndex(id) {
            const m = medsData.find(x => x.id === id);
            const isTaken = medsStatus.takenIds.includes(m.id);
            let notes = JSON.parse(localStorage.getItem('sinet_notes')) || [];
            notes.push({
                id: Date.now(),
                title: `TERAPIJA: ${m.name}`,
                text: `[SINET LIFE] Lek: ${m.name} (${m.dose}). Status za danas: ${isTaken ? 'UZET' : 'NIJE UZET'}. Planirano vreme: ${m.time}h.`,
                date: new Date().toLocaleDateString('sr-RS')
            });
            localStorage.setItem('sinet_notes', JSON.stringify(notes));
            alert("✅ Status leka arhiviran u SINET INDEX!");
        }

        function deleteMed(id) {
            if(confirm("Trajno ukloniti lek iz terapije?")) {
                medsData = medsData.filter(m => m.id !== id);
                localStorage.setItem('sinet_life_meds', JSON.stringify(medsData));
                renderMeds();
            }
        }
    </script>
</body>
</html>
